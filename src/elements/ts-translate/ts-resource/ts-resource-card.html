
<link rel="import" href="../../../components/paper-material/paper-material.html">
<link rel="import" href="../../../components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../../components/iron-pages/iron-pages.html">

<link rel="import" href="./ts-resource-data.html">

<dom-module id="ts-resource-card">

	<style>

        :host {
            flex: auto;
            display: flex;
        }

        paper-material {
            flex: auto;
            display: flex;
            background: var(--card-background-color);
            flex-direction: column;
            border-radius: 3px;
        }

		#heading {
            display: flex;
            flex: 0 0 48px;
		}

        .tab {
            flex: auto;
            margin-top: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--secondary-text-color);
            border-top: 2px solid var(--border-color);
            border-left: 2px solid var(--border-color);
            border-right: 2px solid var(--border-color);
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }

        .tab.unselected {
            font-size: 80%;
            border-bottom: 2px solid var(--border-color);
        }

        .tab.selected {
            font-size: 90%;
            font-weight: bold;
            border-bottom: none;
        }

        .bigspace {
            border-bottom: 2px solid var(--border-color);
            flex: 0 0 16px;
        }

        .littlespace {
            border-bottom: 2px solid var(--border-color);
            flex: 0 0 8px;
        }

        #content {
			padding: 24px 16px;
            flex: auto;
            display: flex;
		}

        .hide {
            display: none;
        }

	</style>

	<template>

        <paper-material elevation="1">
            <div id="heading">
                <template is="dom-if" if="{{chunk.resources.length}}">
                    <div class="bigspace"></div>
                    <template is="dom-repeat" items="{{chunk.resources}}" as="resource">
                        <div class="littlespace"></div>
                        <div class="tab unselected" id="{{createtabid(resource.title)}}" on-tap="updatestate">{{resource.title}}</div>
                        <div class="littlespace"></div>
                    </template>
                    <div class="bigspace"></div>
                </template>
            </div>
            <div id="content">
                <template is="dom-repeat" items="{{chunk.resources}}" as="resource">
                    <ts-resource-data id="{{createpageid(resource.title)}}" class="hide" resource="[[resource]]"></ts-resource-data>
                </template>
            </div>
        </paper-material>

        <iron-signals on-iron-signal-selectresource="selectresource"></iron-signals>

	</template>

</dom-module>

<script>

	Polymer({

		is: 'ts-resource-card',

		properties: {
            chunk: {
                type: Object,
                value: {}
            }
		},

        selectresource: function () {
            var index = this.chunk.state.resource;
            for (var i = 0; i < this.chunk.resources.length; i++) {
                var key = this.chunk.resources[i].title.toLowerCase();
                var tab = document.getElementById(key + "tab" + this.chunk.index);
                var page = document.getElementById(key + "page" + this.chunk.index);
                if (i === index) {
                    tab.classList.add('selected');
                    tab.classList.remove('unselected');
                    page.classList.remove('hide');
                    page.rendertext();
                } else {
                    tab.classList.remove('selected');
                    tab.classList.add('unselected');
                    page.classList.add('hide');
                }
            }
            this.fire('setheight');
        },

        createtabid: function (title) {
            return title.toLowerCase() + "tab" + this.chunk.index;
        },

        createpageid: function (title) {
            return title.toLowerCase() + "page" + this.chunk.index;
        },

        updatestate: function (e) {
            var index = e.model.index;
            var id = this.chunk.meta.chapterid + "-" + this.chunk.meta.frameid;
            this.set('chunk.state.resource', index);
            this.fire('iron-signal', {name: 'updatestate', data: {id: id, mode: "resource", value: index}});
            this.selectresource();
        },

		ready: function() {

		}

	});

</script>
