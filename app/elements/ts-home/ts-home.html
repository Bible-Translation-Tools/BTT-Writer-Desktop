
<link rel="import" href="../../components/iron-icons/iron-icons.html">
<link rel="import" href="../../components/paper-button/paper-button.html">
<link rel="import" href="../../components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../components/neon-animation/neon-animation.html">

<link rel="import" href="../ts-icons/ts-icons.html">
<link rel="import" href="./ts-new-project-button.html">
<link rel="import" href="./ts-home-sidebar.html">

<dom-module id="ts-home">

    <style>

        :host {
            display: flex;
        }

        #main {
            flex: auto;
            display: flex;
            flex-direction: column;
        }

        iron-pages {
            flex: auto;
            display: flex;
        }

        iron-pages > * {
            flex: auto;
        }

        #header {
            background: var(--greyed-out-light);
            color: black;
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            box-shadow: 0 1px 2px 0 #ccc;
        }

        #title {
            flex: auto;
            font-size: 125%;
            padding-left: 20px;
        }

        ts-new-project-button {
            position: absolute;
            right: 15px;
            top: 20px;
        }

        #contain1, #contain2 {
            width: 100%;
            flex: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        #welcome {
            background: white;
            box-shadow: 0 2px 3px 2px var(--greyed-out-light);
            width: 450px;
            margin: 30px 0;
        }

        #start {
            background: var(--primary-color);
            color: var(--text-color);
        }

        p {
            font-size: 110%;
            padding: 0 1.5em;
        }

        table {
            min-width: 450px;
            border-collapse: collapse;
        }

        tbody {
            background: white;
            font-size: 110%;
        }

        tbody tr {
            border-bottom: 1px solid var(--greyed-out-light);
            transition: background .3s, color .3s;
        }

        tbody tr:hover {
            background: var(--accent-color-dark);
            color: var(--text-color);
            cursor: pointer;
        }

        tr:hover .trashcan {
            color: white;
        }

        tr:hover .smallicon {
            color: white;
        }

        tr:hover .smalltext {
            color: white;
        }

        td {
            padding: 15px;
        }

        .smallicon {
            --iron-icon-height: 18px;
            --iron-icon-width: 18px;
            color: var(--greyed-out-dark);
        }

        .trashcan {
            --iron-icon-height: 22px;
            --iron-icon-width: 22px;
            color: var(--greyed-out-dark);
        }

        .smalltext {
            font-size: 75%;
            color: var(--greyed-out-dark);
        }

        #popup {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
            width: 320px;
            height: 220px;
            text-align: center;
        }

        #popup .buttons {
            display: flex;
            justify-content: center;
            color: var(--greyed-out-dark);
        }

        .buttons paper-button:hover {
            color: var(--highlight-primary);
        }

    </style>

    <template>

        <ts-home-sidebar route="{{route}}" selected="{{selected}}" backto="{{backto}}"></ts-home-sidebar>

        <div id="main">
            <div id="header">
                <div id="title">Your Translation Projects</div>
            </div>
            <template is="dom-if" if="{{!projectlist.length}}">
                <div id="contain1">
                    <div id="welcome">
                        <p>Welcome!</p>
                        <p>This is your Home Screen. When you have translation projects on this device, they will appear here.</p>
                        <p>You can start a new project anytime by tapping the blue button in the top right.</p>
                    </div>
                    <paper-button raised id="start" on-tap="start">Start a new project</paper-button>
                </div>
            </template>
            <template is="dom-if" if="{{projectlist.length}}">
                <div id="contain2">
                    <table>
                        <thead>
                        <tr class="smalltext">
                            <td></td><td>Project</td><td>Language</td><td>Progress</td><td></td>
                        </tr>
                        </thead>
                        <tbody>
                        <template is="dom-repeat" items="[[projectlist]]" as="project">
                            <tr>
                                <td on-tap="open"><iron-icon class="smallicon" icon="[[project.icon]]"></iron-icon></td>
                                <td on-tap="open"><span>[[project.name]]</span></td>
                                <td on-tap="open"><span class="smalltext">[[project.language]]</span></td>
                                <td on-tap="open"><span>[[project.completion]]</span></td>
                                <td><paper-icon-button class="trashcan" icon="delete" on-tap="checkdelete" title="delete"></paper-icon-button></td>
                            </tr>
                        </template>
                        </tbody>
                    </table>
                </div>
            </template>
        </div>

        <paper-dialog id="popup" modal="true" entry-animation="scale-up-animation" exit-animation="scale-down-animation">
            <h2>Delete Project</h2>
            <div>
                <p>Are you sure you want to delete this project permanently?</p>
            </div>
            <div class="buttons">
                <paper-button dialog-dismiss>Cancel</paper-button>
                <paper-button dialog-confirm on-tap="deleteproject">Confirm</paper-button>
            </div>
        </paper-dialog>

        <ts-new-project-button route="{{route}}"></ts-new-project-button>

    </template>

</dom-module>

<script>

    Polymer({
        is: 'ts-home',

        properties: {
            route: {
                type: String,
                value: '',
                notify: true
            },
            project: {
                type: Object,
                value: {},
                notify: true
            },
            projectlist: {
                type: Array,
                value: []
            },
            index: {
                type: Number,
                value: null
            },
            backto: {
                type: String,
                notify: true
            }
        },

        start: function () {
            this.route = "new";
        },

        open: function (e) {
            this.project = e.model.project;
            this.route = "translate";
        },

        checkdelete: function (e) {
            var target = e.model.project;
            this.index = this.projectlist.indexOf(target);
            this.$.popup.open();
        },

        deleteproject: function () {
            this.splice('projectlist', this.index, 1);
        },

        ready: function() {

        }

    });

</script>
