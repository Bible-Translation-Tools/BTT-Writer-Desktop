
<link rel="import" href="../../components/neon-animation/neon-animation.html">
<link rel="import" href="../../components/iron-signals/iron-signals.html">
<link rel="import" href="../../components/paper-button/paper-button.html">
<link rel="import" href="../../components/iron-input/iron-input.html">
<link rel="import" href="../../components/paper-dialog/paper-dialog.html">

<link rel="import" href="../ts-home/ts-home.html">
<link rel="import" href="../ts-new/ts-new.html">
<link rel="import" href="../ts-publish/ts-publish.html">
<link rel="import" href="../ts-translate/ts-translate.html">
<link rel="import" href="../ts-settings/ts-settings.html">
<link rel="import" href="./ts-terms.html">

<dom-module id="ts-dashboard">

  <style>

      :host {
          display: flex;
          flex: auto;
      }

      neon-animated-pages {
          flex: auto;
          display: flex;
      }

      neon-animated-pages > * {
          flex: auto;
      }

      .popup {
          position: fixed;
          top: 0;
          bottom: 0;
          left: 0;
          right: 0;
          margin: auto;
      }

      .popup paper-button:hover {
          color: var(--accent-color);
      }

      #feedback {
          display: flex;
          flex-direction: column;
          width: 400px;
          height: 350px;
      }

      #feedbackheader {
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      #feedbackbody {
          display: flex;
          flex-direction: column;
          border-bottom: 1px solid var(--border-color);
          border-top: 1px solid var(--border-color);
          padding: 20px;
      }

      #feedbackbuttons {
          display: flex;
          justify-content: flex-end;
          padding: 0 20px;
      }

      input {
          border: none;
          font-size: 120%;
          padding: 10px;
          color: var(--secondary-text-color);
      }

  </style>

  <template>

      <template is="dom-if" if="{{accepted}}">
          <neon-animated-pages attr-for-selected="data-route" selected="{{route}}">
              <ts-home data-route="home" route="{{route}}" projectlist="[[projectlist]]" backto="{{backto}}"></ts-home>
              <ts-new data-route="new" route="{{route}}" projectlist="[[projectlist]]"></ts-new>
              <ts-translate data-route="translate" route="{{route}}" currentproject="{{currentproject}}" backto="{{backto}}"></ts-translate>
              <ts-publish data-route="publish" route="{{route}}" currentproject="{{currentproject}}"></ts-publish>
              <ts-settings data-route="settings" route="{{route}}" backto="[[backto]]"></ts-settings>
          </neon-animated-pages>
      </template>
      <template is="dom-if" if="{{!accepted}}">
          <ts-terms accepted="{{accepted}}"></ts-terms>
      </template>

      <paper-dialog id="feedback" class="popup" modal="true" entry-animation="scale-up-animation" exit-animation="scale-down-animation">
          <div id="feedbackheader">
              <h2>Feedback</h2>
              <p>This will use your internet connection</p>
          </div>
          <div id="feedbackbody">
              <input is="iron-input" bind-value="{{feedback}}" placeholder="Describe the problem you are experiencing">
          </div>
          <div id="feedbackbuttons">
              <paper-button on-tap="closefeedback">Cancel</paper-button>
              <paper-button on-tap="sendfeedback">Confirm</paper-button>
          </div>
      </paper-dialog>

      <iron-signals on-iron-signal-updatelist="updatelist"></iron-signals>
      <iron-signals on-iron-signal-setdefault="setdefault"></iron-signals>
      <iron-signals on-iron-signal-openfeedback="openfeedback"></iron-signals>

  </template>

</dom-module>

<script>

  Polymer({
      is: 'ts-dashboard',

      properties: {
          route: {
              type: String,
              value: 'home',
              observer: '_routeChanged'
          },
          projectlist: {
              type: Array,
              value: []
          },
          currentproject: {
              type: Object,
              value: {}
          },
          accepted: {
              type: Boolean,
              value: false
          },
          backto: {
            type: String,
            value: ""
          },
          feedback: {
              type: String,
              value: ""
          }
      },

      openfeedback: function () {
          this.feedback = "";
          this.$.feedback.open();
      },

      closefeedback: function () {
          this.$.feedback.close();
      },

      sendfeedback: function () {
          //do stuff
          this.closefeedback();
      },

      _routeChanged: function (event) {
          var el = this.querySelector('[data-route="' + this.route + '"]');
          // The async delay prevents a flicker. It's a UI thing, not a logic thing.
          el && el.forceResize && this.async(el.forceResize.bind(el), 30);
      },

      updatelist: function () {
          var mythis = this;
          App.projectsManager.loadTargetTranslationsList().then(function(list) {
              mythis.set('projectlist', list);
          });
      },

      setdefault: function () {
          this.currentproject = {};
      },

      ready: function() {
          this.updatelist();
          this.setdefault();
          var accepted = App.configurator.getValue("accepted");
          if (accepted) {
              this.accepted = true;
          }
      }

  });

</script>
