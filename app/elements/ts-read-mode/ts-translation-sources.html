<!-- ts-translation-sources -->

<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/iron-list/iron-list.html">
<link rel="import" href="../../components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../components/paper-checkbox/paper-checkbox.html">

<dom-module id="ts-translation-sources">

    <style>

        :host {
            display: none;
            height: 100vh;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
            background-color: rgba(0,0,0,0.5);
            box-sizing: border-box;
        }
        .container {
            display: block;
            position: fixed;
            width: 60%;
            height: 80%;
            min-height: 320px;
            max-height: 800px;
            top: calc(50% + 18px);
            transform: translateY(-50%);
            left: 0;
            right: 0;
            overflow: hidden;
            margin-left: auto;
            margin-right: auto;
            background: white;
            box-shadow: -4px 0 30px rgba(22, 22, 22, 0.3);
        }
        [icon="arrow-back"] {
            margin: 0 .2em;
        }

        [icon="search"] {
            padding: 0;
        }
        .header {
            color: #888;
            font-style: italic;
            font-family: 'Roboto';
            font-size: 110%;
            height: 56px;
            border-bottom: 1px solid #EEE;
        }
        .header span {
            display: block;
            padding: 1em;
        }
        .body {
            height: calc(100% - 56px - 56px);
            overflow-y: auto;
        }
        .selected-list {
            font-family: 'Roboto';
            font-size: 110%;
        }
        .row {
            display: block;
            margin: 0;
            padding: 1em;
            border-bottom: 1px solid #EEE;
        }
        .row:hover {
            background: var(--accent-color-dark);
            box-shadow: inset 0 -1px rgba(0,0,0,0);
            color: #fff;
        }
        .row-header {
            display: block;
            margin: 0;
            padding: 0.25em 1em;
            background-color: #EEE;
            text-transform: uppercase;
            font-size: 80%;
            color: #888;
            font-weight: 500;
            border-bottom: 1px solid #E4E4E4;
        }
        .right {
            float: right;
        }
        .clickable {
            cursor: pointer;
        }
        .footer {
            width: 100%;
            height: 56px;
            position: absolute;
            bottom: 0;
            border-top: 1px solid #EEE;
        }
        paper-button {
            margin-top: 0.6rem;
            color: #00C5E8;
        }
        ::-webkit-scrollbar {
            display: none;
        }
        paper-checkbox[disabled][checked]::shadow #checkbox.paper-checkbox {
            background-color: #00C5E8;
            border-color: #00C5E8;
        }
        paper-checkbox[disabled]::shadow #checkbox.paper-checkbox {
            opacity: 1;
        }

    </style>

    <template>

        <div id="container" class="container">
            <div class="header">
                <span>Choose source translations<paper-icon-button class="right" icon="search"></paper-icon-button></span>
            </div>

            <div class="body">
                <div id="selected-sources-header" class="row-header">
                    <span>Selected</span>
                </div>
                <iron-list id="selected-list" items="[[ selectedList ]]" as="sl">
                    <template>
                        <div class="row clickable" on-tap="removeSelected">
                            <span>[[ sl.title ]]</span>
                            <paper-checkbox class="right" disabled checked style="opacity: 1;"></paper-checkbox>
                        </div>
                    </template>
                </iron-list>

                <div id="available-sources-header" class="row-header">
                    <span>Available</span>
                </div>
                <iron-list id="available-list" items="[[ availableList ]]" as="al" selection-enabled multi-selection>
                    <template>
                        <div class="row clickable" on-tap="selectAvailable">
                            <span>[[ al.title ]]</span>
                            <paper-checkbox class="right" disabled style="opacity: 1;"></paper-checkbox>
                        </div>
                    </template>
                </iron-list>
            </div>

            <div class="footer">
                <paper-button class="right" on-tap="confirm">Confirm</paper-button>
                <paper-button class="right" on-tap="cancel">Cancel</paper-button>
            </div>

        </div>

   </template>

</dom-module>

<script>

    Polymer({

        is: 'ts-translation-sources',

        properties: {
            masterList: {
                type: Array,
                value: []
            },
            availableList: {
                type: Array,
                value: []
            },
            selectedList: {
                type: Array,
                value: []
            },
            initialSelected: {
                type: Array,
                value: []
            }
        },

        getAvailable: function(selectedList) {
            var me = this;
            return me.masterList.filter(function(i) {
                return selectedList.indexOf(i) < 0;
            });
        },

        cancel: function() {
            this.selectedList = this.initialSelected.slice();
            this.availableList = this.getAvailable(this.selectedList);
            this.style.display = 'none';
        },

        confirm: function() {
            this.style.display = 'none';
        },

        selectAvailable: function(event) {
            var elem = event.model.al;
            var index = event.model.index;
            elem.checked = true;
            this.push('selectedList', elem);
            this.async(function() {
                this.availableList = this.getAvailable(this.selectedList);
            }, 1);
        },

        removeSelected: function(event) {
            var elem = event.model.sl;
            var index = event.model.index;
            elem.checked = false;
            this.splice('selectedList', index, 1);
            this.async(function() {
                this.availableList = this.getAvailable(this.selectedList);
            }, 1);
        },

        attached: function () {
            this.masterList = [{title: 'Thing 1'}, {title: 'Thing 2'}, {title: 'Thing 3'}];
            this.selectedList = [];
            this.availableList = this.getAvailable(this.selectedList);
            this.initialSelected = this.selectedList.slice();
        }
    });

</script>
